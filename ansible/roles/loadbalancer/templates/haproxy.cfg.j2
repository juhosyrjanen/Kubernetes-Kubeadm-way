global
    daemon
    maxconn 256

defaults
    mode http
    timeout connect 5000ms
    timeout client 50000ms
    timeout server 50000ms

frontend kubernetes_api
    bind {{ kubernetes_lb_ip }}:6443
    mode tcp
    default_backend kubernetes_api_backend

backend kubernetes_api_backend
    mode tcp
    balance roundrobin
    {% for server in haproxy_backend_servers %}
    server controller{{ loop.index }} {{ server }}:6443 check
    {% endfor %}

